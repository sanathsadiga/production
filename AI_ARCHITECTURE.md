# ðŸ¤– AI System Architecture & Data Flow

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AdminDashboard.tsx                                          â”‚  â”‚
â”‚  â”‚  - AI Insights Tab (new)                                    â”‚  â”‚
â”‚  â”‚  - Risk cards (HIGH/MEDIUM/LOW)                             â”‚  â”‚
â”‚  â”‚  - Maintenance Recommendations                              â”‚  â”‚
â”‚  â”‚  - Model Performance Metrics                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP/REST
                           â”‚ (Bearer Token Auth)
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND (Node.js + Express)                             â”‚
â”‚  Port: 5004                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /api/ai/* Routes                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ GET  /predictions          (get risk scores)           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ GET  /recommendations      (get maintenance plans)     â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ POST /batch-analysis       (trigger daily training)    â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ GET  /model-info           (model status)              â”‚  â”‚
â”‚  â”‚  â””â”€â”€ GET  /health               (service health)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ML Service Client (mlService.ts)                            â”‚  â”‚
â”‚  â”‚  - Calls Python service                                      â”‚  â”‚
â”‚  â”‚  - Handles responses                                         â”‚  â”‚
â”‚  â”‚  - Error handling                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP/REST
                           â”‚ (Port 5001)
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ML SERVICE (Python + Flask)                                 â”‚
â”‚  Port: 5001                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Flask Routes                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ /predict             - Make predictions                 â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ /recommendations     - Generate recommendations        â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ /batch-analysis      - Daily training                  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ /health              - Service health                  â”‚  â”‚
â”‚  â”‚  â””â”€â”€ /model-info          - Model status                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ML Pipeline                                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Data Fetching        (fetch_production_data)           â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Queries last 30-90 days                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Feature Engineering  (engineer_features)                â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ Aggregations (daily stats)                         â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ Efficiency metrics (plates/page, ratios)           â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ Moving averages (3-day, 7-day)                     â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ Deviations (from moving avg)                       â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Temporal features (day of week)                    â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Model Training       (train_downtime_model)            â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ Random Forest (100 trees)                          â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ Feature scaling (StandardScaler)                   â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ 80/20 train-test split                             â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Balanced class weights                             â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Predictions          (predict_maintenance_risk)        â”‚  â”‚
â”‚  â”‚      â”œâ”€â”€ Risk score (0-100%)                                â”‚  â”‚
â”‚  â”‚      â”œâ”€â”€ Risk level (HIGH/MEDIUM/LOW)                       â”‚  â”‚
â”‚  â”‚      â””â”€â”€ Anomaly details                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Models Storage                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ ./models/downtime_model.pkl     (trained model)        â”‚  â”‚
â”‚  â”‚  â””â”€â”€ ./models/scaler.pkl              (feature scaler)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ SQL Queries
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MySQL Database                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  production_records                                          â”‚  â”‚
â”‚  â”‚  - record_date, machine_id, total_pages                     â”‚  â”‚
â”‚  â”‚  - plate_consumption, color_pages, bw_pages                 â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  downtime_details                                            â”‚  â”‚
â”‚  â”‚  - machine_id, downtime_reason, total_seconds               â”‚  â”‚
â”‚  â”‚  - record_date, downtime_duration                           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  machines                                                    â”‚  â”‚
â”‚  â”‚  - id, name (for joining)                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CRON JOB (Daily)                                  â”‚
â”‚  Runs at: 2 AM every day                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  daily_retrain.sh                                            â”‚  â”‚
â”‚  â”‚  - Triggers batch-analysis endpoint                          â”‚  â”‚
â”‚  â”‚  - Retrains models with 90-day data                          â”‚  â”‚
â”‚  â”‚  - Logs results to daily_retrain.log                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

### 1. **Daily Retraining Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2:00 AM    â”‚
â”‚  Cron Job   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /batch-analysis â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fetch_production_data(90 days)       â”‚
â”‚ â†“ SELECT * FROM production_records   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fetch_downtime_data(90 days)         â”‚
â”‚ â†“ SELECT * FROM downtime_details     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ engineer_features(df_prod, df_down)  â”‚
â”‚ â”œâ”€ Daily aggregations                â”‚
â”‚ â”œâ”€ Efficiency metrics                â”‚
â”‚ â”œâ”€ Moving averages                   â”‚
â”‚ â””â”€ Label with downtime events        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ train_downtime_model(X, y)           â”‚
â”‚ â”œâ”€ 80/20 split                       â”‚
â”‚ â”œâ”€ StandardScaler                    â”‚
â”‚ â”œâ”€ RandomForest(100 trees)           â”‚
â”‚ â””â”€ Save model.pkl                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Save model & scaler to disk          â”‚
â”‚ â””â”€ ./models/downtime_model.pkl       â”‚
â”‚ â””â”€ ./models/scaler.pkl               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return training metrics              â”‚
â”‚ â”œâ”€ train_accuracy: 87.5%             â”‚
â”‚ â””â”€ test_accuracy: 82.3%              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **Prediction Request Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend User      â”‚
â”‚ Clicks "AI Insights"
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/ai/predictions          â”‚
â”‚ Authorization: Bearer TOKEN      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: aiRouter.get('/predictions')
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ mlAPI.getMaintenancePredictions()      â”‚
â”‚ fetch('http://localhost:5001/predict')  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ML Service: GET /predict             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ fetch_production_data(30 days)
       â”‚  â””â”€ SELECT * FROM production_records
       â”‚
       â”œâ”€ engineer_features()
       â”‚  â””â”€ Calculate same features as training
       â”‚
       â”œâ”€ Load model & scaler
       â”‚  â””â”€ downtime_model.pkl, scaler.pkl
       â”‚
       â”œâ”€ Scale features
       â”‚
       â”œâ”€ predict_proba(X_scaled)
       â”‚  â””â”€ Get probability for each machine
       â”‚
       â””â”€ Build response
          â”œâ”€ machine_id, machine_name
          â”œâ”€ downtime_risk (0-100%)
          â”œâ”€ risk_level (LOW/MEDIUM/HIGH)
          â”œâ”€ plates_per_page
          â””â”€ plates_deviation
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return JSON response                  â”‚
â”‚ {                                     â”‚
â”‚   "predictions": [                    â”‚
â”‚     {                                 â”‚
â”‚       "machine_id": 1,                â”‚
â”‚       "machine_name": "Machine A",    â”‚
â”‚       "downtime_risk": 75.5,          â”‚
â”‚       "risk_level": "HIGH",           â”‚
â”‚       ...                             â”‚
â”‚     }                                 â”‚
â”‚   ]                                   â”‚
â”‚ }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend displays      â”‚
â”‚ - Risk cards           â”‚
â”‚ - Risk level badges    â”‚
â”‚ - Anomaly details      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. **Recommendation Generation Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/ai/recommendations  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ get_recommendations()                   â”‚
â”‚ 1. Call predict_maintenance_risk()      â”‚
â”‚    â†“ Get all predictions                â”‚
â”‚                                          â”‚
â”‚ 2. Loop through predictions              â”‚
â”‚    â”œâ”€ HIGH (>70%) risk:                 â”‚
â”‚    â”‚  â””â”€ URGENT (schedule in 1 day)     â”‚
â”‚    â”‚                                    â”‚
â”‚    â””â”€ MEDIUM (40-70%) risk:             â”‚
â”‚       â””â”€ NORMAL (plan in 3 days)        â”‚
â”‚                                          â”‚
â”‚ 3. Include:                              â”‚
â”‚    â”œâ”€ Machine name                      â”‚
â”‚    â”œâ”€ Priority level                    â”‚
â”‚    â”œâ”€ Recommendation text               â”‚
â”‚    â”œâ”€ Reason (efficiency deviation)     â”‚
â”‚    â””â”€ Suggested date                    â”‚
â”‚                                          â”‚
â”‚ 4. Return sorted by priority            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JSON Response                      â”‚
â”‚ {                                  â”‚
â”‚   "recommendations": [             â”‚
â”‚     {                              â”‚
â”‚       "machine_id": 1,             â”‚
â”‚       "machine_name": "Machine A", â”‚
â”‚       "priority": "URGENT",        â”‚
â”‚       "recommendation": "...",     â”‚
â”‚       "reason": "...",             â”‚
â”‚       "suggested_date": "2026-02-13"
â”‚     }                              â”‚
â”‚   ],                               â”‚
â”‚   "total_urgent": 2,               â”‚
â”‚   "total_normal": 3                â”‚
â”‚ }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Feature Engineering Pipeline

```
Raw Production Data
â”‚
â”œâ”€ record_date          Total Pages
â”œâ”€ machine_id           Color Pages
â”œâ”€ total_pages          B&W Pages
â”œâ”€ plate_consumption    Num Records
â”‚
â†“
Daily Aggregation (GROUP BY machine_id, date)
â”‚
â”œâ”€ SUM(total_pages)     â†’ total_pages
â”œâ”€ SUM(plate_consumption) â†’ total_plates
â”œâ”€ SUM(color_pages)     â†’ color_pages
â”œâ”€ SUM(bw_pages)        â†’ bw_pages
â”œâ”€ COUNT(id)            â†’ num_records
â”‚
â†“
Efficiency Metrics
â”‚
â”œâ”€ plates_per_page = total_plates / total_pages
â”œâ”€ color_ratio = color_pages / total_pages
â”œâ”€ bw_ratio = bw_pages / total_pages
â”‚
â†“
Time Series Features (Rolling Windows)
â”‚
â”œâ”€ plates_per_page_ma3   (3-day rolling avg)
â”œâ”€ plates_per_page_ma7   (7-day rolling avg)
â”œâ”€ total_pages_ma3       (3-day rolling avg)
â”‚
â†“
Anomaly Detection (Deviations)
â”‚
â”œâ”€ plates_deviation = plates_per_page - plates_per_page_ma7
â”œâ”€ pages_deviation = total_pages - total_pages_ma3
â”‚
â†“
Temporal Features
â”‚
â”œâ”€ day_of_week  (0-6: Monday-Sunday)
â”œâ”€ week_number  (1-53)
â”‚
â†“
Final Features (14 total) â†’  ML Model
â”‚
â”œâ”€ total_pages              â”œâ”€ Standard Scaler
â”œâ”€ total_plates             â”œâ”€ Random Forest
â”œâ”€ color_pages              â”œâ”€ 100 Trees
â”œâ”€ bw_pages                 â”œâ”€ Max Depth: 10
â”œâ”€ num_records              â””â”€ Balanced Weights
â”œâ”€ plates_per_page
â”œâ”€ color_ratio
â”œâ”€ bw_ratio
â”œâ”€ plates_per_page_ma3
â”œâ”€ plates_per_page_ma7
â”œâ”€ total_pages_ma3
â”œâ”€ plates_deviation
â”œâ”€ pages_deviation
â””â”€ day_of_week
```

## Model Training & Validation

```
Raw Data (90 days)
â”‚
â†“
Feature Engineering
â”‚
â†“
Dataset: 2,700 daily records (approx)
â”‚
â”œâ”€ Training Set (80%): 2,160 records
â”‚  â””â”€ Used to learn patterns
â”‚
â””â”€ Test Set (20%): 540 records
   â””â”€ Used to evaluate performance
   â”‚
   â†“
Train Model           Evaluate Model
â”‚                     â”‚
â”œâ”€ Load X_train_scaledâ”œâ”€ Load X_test_scaled
â”‚  â”‚                  â”‚
â”‚  â””â”€ RandomForest.fit â”œâ”€ model.predict_proba
â”‚                      â”‚
â”‚                      â”œâ”€ Calculate accuracy
â”‚                      â”œâ”€ Calculate precision
â”‚                      â”œâ”€ Calculate recall
â”‚                      â”‚
                       â†“
                   Metrics:
                   - Train Accuracy: ~87%
                   - Test Accuracy: ~82%
                   - Balanced classification
                   â”‚
                   â†“
           Save Model & Scaler
           â”‚
           â”œâ”€ downtime_model.pkl (Trained RandomForest)
           â””â”€ scaler.pkl (StandardScaler fit)
```

## Risk Level Calculation

```
Predicted Probability (0 to 1)
â”‚
â”œâ”€ Multiply by 100 â†’ Risk Score (0 to 100%)
â”‚
â”œâ”€ if > 70%  â†’ HIGH risk     (RED)
â”œâ”€ if 40-70% â†’ MEDIUM risk   (ORANGE)
â””â”€ if < 40%  â†’ LOW risk      (GREEN)
    â”‚
    â†“
Recommendation Priority
â”‚
â”œâ”€ HIGH   â†’ URGENT (schedule in 1 day)
â”œâ”€ MEDIUM â†’ NORMAL (plan in 3 days)
â””â”€ LOW    â†’ MONITOR (check weekly)
    â”‚
    â†“
Reason for Risk
â”‚
â”œâ”€ plates_deviation > 1 std: "High plate efficiency deviation"
â”œâ”€ pages_deviation > 1 std:  "Unusual page count changes"
â””â”€ Machine learning score:   "Model predicts downtime risk"
```

---

This system provides **early warning** for maintenance needs before failures occur!
